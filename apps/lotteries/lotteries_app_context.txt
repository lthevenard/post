LOTTERIES APP — PROJECT CONTEXT (Milestones A, B and C in progress)

This document summarizes the current state of the Lotteries app, its structure,
design decisions, completed milestones, and pending issues. It is meant to be
reused as context in future ChatGPT sessions to preserve project continuity.

============================================================
1. GENERAL CONTEXT
============================================================

The Lotteries app is a JavaScript reimplementation of a previously existing
Shiny app (R), integrated into a personal static website hosted on GitHub Pages.

The app lives inside the site under:
  #/pt/apps/lotteries
  #/en/apps/lotteries

Routing is handled by a central apps router, which dynamically loads each app.
The Lotteries app is self-contained, with its own UI, logic, and CSS, but visually
integrated with the site's identity (colors, typography).

Guiding principles:
- Treat the original Shiny app as a functional specification.
- Rebuild incrementally using vanilla JavaScript (no frameworks).
- Separate concerns clearly: parsing, validation, model logic, views, wiring.
- Each milestone must produce visible, testable outputs.

============================================================
2. FILE STRUCTURE (CURRENT)
============================================================

apps/
└─ lotteries/
   ├─ index.js
   │   - Entry point of the app.
   │   - Exports mountApp(mount, { lang }) for the central router.
   │   - Injects app-specific CSS.
   │   - Wires:
   │       - Tab click handlers.
   │       - "Simulate" button.
   │       - Seed logic (Milestone C).
   │       - Slider + animation logic (Milestone C).
   │   - Renders content for:
   │       - Lottery 1 tab
   │       - Lottery 2 tab
   │       - Simulation / Comparisons tab
   │
   ├─ styles.css
   │   - App-specific styling.
   │   - Full-bleed layout and light surface.
   │   - Cards, tabs, buttons, charts.
   │   - Custom-styled range slider (Milestone C).
   │
   ├─ views/
   │   ├─ page.js
   │   │   - Renders the full UI structure.
   │   │   - Sidebar + main area + tabs.
   │   │   - Sidebar inputs for lotteries and N.
   │   │   - Seed selection UI (auto/manual).
   │   │   - Exposes helpers:
   │   │       - getRawInputs()
   │   │       - setError()
   │   │       - clearError()
   │   │       - setActiveTab()
   │   │
   │   └─ charts.js
   │       - SVG chart renderers (Milestone B and C).
   │       - Distribution bar chart.
   │       - Expected value + standard deviation chart.
   │       - Charts are responsive, SVG-based, no dependencies.
   │
   ├─ model/
   │   ├─ lottery.js
   │   │   - Parsing and validation logic.
   │   │   - parseAndValidateLottery()
   │   │   - validateLottery()
   │   │   - describeLottery():
   │   │       - outcome labels (A, B, C…)
   │   │       - cumulative probabilities
   │   │       - expected value
   │   │       - theoretical standard deviation
   │   │       - grouped distribution
   │   │
   │   └─ simulation.js
   │       - Simulation engine (Milestone C).
   │       - Deterministic seeded RNG (Mulberry32).
   │       - Seed validation and generation (5-digit integers).
   │       - buildSimulationTable(N, …):
   │           - Simulates tickets from 1..N incrementally.
   │           - Tracks outcome counts, total returns,
   │             mean returns, and profit vs EV.
   │       - getRowForTickets(table, N).
   │
   └─ (future)
       └─ copy.js (optional explanatory text)

shared/
└─ parsing/
   └─ listParser.js
       - Generic helper to parse semicolon-separated numeric lists.
       - Used by lottery.js.

============================================================
3. MILESTONE A — INPUT PARSING & VALIDATION (COMPLETED)
============================================================

Goals:
- Verify correct parsing of inputs.
- Ensure UI is fully interactive.
- Provide visible feedback for testing.

What works:
- Sidebar inputs for Lottery 1 and Lottery 2 (payoffs and probabilities).
- Parsing of semicolon-separated lists (e.g., "20; 40; 0").
- Validation rules:
  - Same length for payoffs and probabilities.
  - Probabilities must sum to 1.
  - Probabilities in [0, 1].
  - Maximum of 20 outcomes.
  - Dot (.) as decimal separator only.
- "Simulate" button is fully wired.
- Clear error messages on validation failure.
- Tabs (About, Lottery 1, Lottery 2, Simulation, Instructions) switch correctly.

============================================================
4. MILESTONE B — THEORETICAL RESULTS (COMPLETED)
============================================================

Goals:
- Reproduce the theoretical part of the Shiny app.

Implemented features:
- Outcome labels (A, B, C…).
- Textual description of lottery returns.
- Expected Value (EV).
- Theoretical standard deviation.
- SVG charts:
  - Theoretical distribution (bar chart).
  - EV ± σ chart (single-lottery view).
- Careful visual hierarchy:
  - Large section titles.
  - Card-based layout.
  - Charts appear before solution boxes.
- SVG charts are:
  - Responsive.
  - Clean (no rounded bars or shadows).
  - With axes, ticks, plot box, and consistent colors.

============================================================
5. MILESTONE C — SIMULATION ENGINE (IN PROGRESS)
============================================================

Goals:
- Reproduce the simulation logic of the Shiny app.
- Allow incremental simulation from 1..N tickets.
- Ensure reproducibility via random seed.

Implemented features:
- Deterministic seeded RNG.
- Seed UI:
  - Option to generate a random seed.
  - Option to manually input a 5-digit seed (10000–99999).
- Same seed is used for both lotteries.
- Simulation logic:
  - For each N, simulates N draws, consuming RNG sequentially.
  - Tracks outcome counts, total returns, mean returns, and profit.
- Simulation tab:
  - Displays the seed used.
  - Slider to select number of tickets (N).
  - Play / Stop buttons to animate the slider (Shiny-like behavior).
  - Table showing relative frequencies of outcomes for Lottery 1 vs Lottery 2
    at the selected N.

Known issues / pending work:
- Slider still has visual/UX issues:
  - Fill behavior needs fine-tuning.
  - Initial position and maximum reach were recently fixed but need review.
  - Value display was moved to a large box on the right (desired),
    but styling still needs final polish.
- Simulation charts are not yet implemented:
  - Mean Returns vs Tickets (with EV reference line).
  - Graphical comparison of relative frequencies (bar chart).

============================================================
6. VISUAL / UX DECISIONS
============================================================

- Full-bleed layout to allow wide charts and tables.
- Light app surface (distinct from the dark-blue site background).
- Site identity preserved via CSS variables:
  - --bg   (deep blue, primary accent).
  - --link (lighter blue, interactive elements).
- No global site CSS was modified.
- App CSS is dynamically injected on mount.

============================================================
7. NEXT STEPS (FOR FUTURE CHATS)
============================================================

Immediate (Milestone C continuation):
- Finalize slider behavior and styling.
- Ensure consistent behavior across browsers.

Next milestones:
- Add simulation charts:
  - Mean Returns vs Tickets (SVG).
  - Relative frequency bar charts for selected N.
- Minor refactoring of index.js (reduce handler size).
- Optional CSV export of simulation tables.
- Accessibility improvements.

============================================================
8. DESIGN PRINCIPLES TO KEEP
============================================================

- Vanilla JavaScript only.
- No external charting libraries.
- Shiny app as behavioral reference.
- Incremental milestones with visible outputs.
- Clear separation between model, view, and wiring.

END OF FILE
